# Do not use this for production.
version: "3"

services:
  zetacore0:
    container_name: zetacore0
    env_file:
      - .env
    image: zetacore:latest
    environment:
      - NODE_NUMBER=0
    volumes:
      - ./storage/node0/zetaclient:/root/.zetaclient
      - ./storage/node0/zetacore:/root/.zetacore
      - ./storage/node0/tss:/root/.tss
      - ./storage/node0/tssnew/:/root/.tssnew/
      - ./zeta-node/build:/scripts
    ports:
        - "${REST_ENDPOINT}:1317" # REST_ENDPOINT
        - "${gRPC_PORT}:9090" # gRPC_PORT
        - "${RPC_PORT}:26657" # RPC_PORT
    networks:
      - localnet
    command: /scripts/zetacored-start.sh

  zetaclient0:
    container_name: zetaclient0
    restart: unless-stopped
    env_file:
      - .env
    image: zetaclient:latest
    environment:
      - NODE_NUMBER=0
      - BOOTNODE_IP=zetacore0
      - CHAIN_IP=zetacore0
      - ETH_MPI_ADDRESS=$ETH_MPI_ADDRESS
      - BSC_MPI_ADDRESS=$BSC_MPI_ADDRESS
      - POLYGON_MPI_ADDRESS=$POLYGON_MPI_ADDRESS
      - ETH_ENDPOINT=http://ethereum-geth-rpc-endpoint-1.localnet:8545
      - BSC_ENDPOINT=http://bsc_bsc-rpc_1.localnet:8545
      - POLYGON_ENDPOINT=http://bor.localnet:8545
    volumes:
      - ./storage/node0/zetaclient:/root/.zetaclient
      - ./storage/node0/zetacore:/root/.zetacore
      - ./storage/node0/tss:/root/.tss
      - ./storage/node0/tssnew/:/root/.tssnew/
      - ./zeta-node/build:/scripts
    networks:
      - localnet
    command: -c "/scripts/zetaclient-start.sh 0"

  # zetacore1:
  #   container_name: zetacore1
  #   env_file:
  #     - .env
  #   image: zetacore:latest
  #   environment:
  #     - NODE_NUMBER=1
  #   volumes:
  #     - ./storage/node1/zetaclient:/root/.zetaclient
  #     - ./storage/node1/zetacore:/root/.zetacore
  #     - ./storage/node1/tss:/root/.tss
  #     - ./storage/node1/tssnew/:/root/.tssnew/
  #     - ./zeta-node/build:/scripts
  #   # ports:
  #       # - "${REST_ENDPOINT1}:1317" # REST_ENDPOINT
  #       # - "${gRPC_PORT1}:9090" # gRPC_PORT
  #       # - "${RPC_PORT1}:26657" # RPC_PORT

  #   networks:
  #     priv-zetachain-net:
  #   command: /scripts/zetacored-start.sh

  # zetaclient1:
  #   container_name: zetaclient1
  #   env_file:
  #     - .env
  #   image: zetaclient:latest
  #   environment:
  #     - NODE_NUMBER=1
  #     - NODE_0_DNS=zetacore1
  #     - CHAIN_IP=zetacore1
  #   volumes:
  #     - ./storage/node1/zetaclient:/root/.zetaclient
  #     - ./storage/node1/zetacore:/root/.zetacore
  #     - ./storage/node1/tss:/root/.tss
  #     - ./storage/node1/tssnew/:/root/.tssnew/
  #     - ./zeta-node/build:/scripts
  #   networks:
  #     priv-zetachain-net:
  #   command: /scripts/zetaclient-start.sh 1 # ./zetaclient-start.sh $NODE_NUMBER #NODE_0_DNS $NODE_0_IP
 
networks:
  localnet: 
    external: true
    name: localnet
    ipam:
      config:
      - subnet: 172.24.254.0/16
    ipam:
      config:
      - subnet: 172.24.254.0/16
  # priv-zetachain-net:
  #   driver: bridge
  #   ipam:
  #     config:
  #     - subnet: 172.16.254.128/28