version: 0.2

env:
  shell: "/bin/bash"
  git-credential-helper: yes
  
  variables:

  exported-variables:
    GOVERSION: "go1.17.8"
    GOPATH: "/usr/local/go"


phases:
  install:
    commands:
      # Install ZetaCore PreReqs - Amazon Linux
      - echo "Install Phase"
      - yum install -y make gcc jq
      - wget https://golang.org/dl/go1.17.8.linux-amd64.tar.gz
      - tar -C /usr/local -xzf go1.17.8.linux-amd64.tar.gz
      - export GOVERSION=go1.17.8
      - export PATH="$PATH:/usr/local/go/bin:/root/go/bin"
      - export GOPATH="/usr/local/go"
      - go version
      - which go

  # pre_build:
  #   commands:
  #     - echo "Pre-Build Phase"

  build:
    commands:
      - export GOVERSION=go1.17.8
      - export PATH="$PATH:/usr/local/go/bin:/root/go/bin"
      - export GOPATH="/usr/local/go"
      - echo "Build Phase"
      - make install

  # post_build:
  #   commands:
  #     - echo "Post Build Phase"

artifacts:
  discard-paths: yes
  files:
      - /root/go/bin/zetaclientd
      - /root/go/bin/zetacored
      - appspec.yml
      - aws-scripts/*
      - build/zetaclient-start.sh
      - build/zetacored-start.sh