version: 0.2

env:
  shell: "/bin/bash"
  # variables:
  #   GOPATH: "/root/go"
  # exported-variables:
  #   - GOPATH


phases:
  install:
    commands:
      # Install ZetaCore PreReqs - Amazon Linux
      - echo "Install Phase"
      - yum install -y make gcc jq
      - export PATH="$PATH:/usr/local/go/bin:/root/go/bin"
      - export GOPATH="/root/go"
      - wget https://golang.org/dl/go1.17.3.linux-arm64.tar.gz
      - tar -C /usr/local -xzf go1.17.3.linux-arm64.tar.gz

  pre_build:
    commands:
      - echo "Pre-Build Phase"

  build:
    commands:
      - echo "Build Phase"
      - make install

  post_build:
    commands:
      - echo "Post Build Phase"
      - ls /root/go/bin
      - ls

artifacts:
  discard-paths: yes
  files:
      - /root/go/bin/zetaclientd
      - /root/go/bin/zetacored
      - appspec.yml
      - aws-scripts/*



#   install:
#     commands:
#       - $(aws ecr get-login --no-include-email)

#   build:
#     commands:
#       - docker build . -t "$REPO_URI"
#       - docker push "$REPO_URI"

#   post_build:
#     commands:
#       - if [ "$CODEBUILD_BUILD_SUCCEEDING" -eq 0 ]; then echo "Build failed. Skipping."; exit 1; fi
#       - printf '[{"name":"%s","imageUri":"%s"}]' "$NAME" "$REPO_URI" > imagedefinitions.json
#       - cat imagedefinitions.json

# artifacts:
#   files:
#       - imagedefinitions.json
      # - '**/*'

